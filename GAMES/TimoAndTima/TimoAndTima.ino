#include <Gamebuino-Meta.h>
#include "sprite.h"
#include "sound.h"

// level //
/*  00 = vide
 *  01 = mur
 *  02 = timo
 *  03 = tima
 *  04 = base timo
 *  05 = base tima
 *  06 = pique b
 *  07 = pique h
 *  08 = pique g
 *  09 = pique d 
 *  10 = dblock
*/
int level_1[8][10] = {
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  { 1, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  { 1, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  { 1, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  { 1, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  { 1, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  { 1, 2, 0, 0, 0, 0, 0, 0, 3, 1},
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
};

int level1[8][10] = {
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  { 1, 4, 0, 0, 1, 1, 0, 0, 5, 1},
  { 1, 0, 0, 0, 1, 1, 0, 0, 0, 1},
  { 1,10, 0, 0, 1, 1, 0, 0,10, 1},
  { 1, 0, 0, 8, 1, 1, 9, 0, 0, 1},
  { 1, 0, 0, 0, 1, 1, 0, 0, 0, 1},
  { 1, 2, 0, 0, 0, 0, 0, 0, 3, 1},
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
};
int level2[8][10] = {
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  { 1, 6, 6, 6, 6, 6, 6, 6, 6, 1},
  { 1, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  { 1, 2,10, 0, 0, 0, 0, 0, 3, 1},
  { 1, 0, 0, 0, 0, 0, 0, 4, 5, 1},
  { 1,10, 0,10, 0, 0, 0, 0, 0, 1},
  { 1, 7, 7, 7, 7, 7, 7, 7, 7, 1},
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
};
int level3[8][10] = {
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  { 1, 5, 6, 0, 0, 0, 4, 0, 0, 1},
  { 1, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  { 1, 2, 0, 0, 1, 0, 0, 0, 0, 1},
  { 1, 3, 0, 0, 0, 1, 0, 0, 0, 1},
  { 1, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  { 1, 0, 0, 0, 0,10, 0, 0, 0, 1},
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
};
int level6[8][10] = {
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  { 1, 0, 0,10, 5, 1, 6, 0, 0, 1},
  { 1, 0, 0, 0, 1, 1, 0, 0, 8, 1},
  { 1, 0, 0, 0, 1, 1, 0, 0, 1, 1},
  { 1, 0, 0, 0,10,10, 0, 0, 0, 1},
  { 1, 0, 0, 0, 1, 1, 0, 0, 0, 1},
  { 1, 2, 1, 0, 4, 1, 0, 0, 3, 1},
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
};
int level5[8][10] = {
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  { 1, 3, 0,10,10, 0, 0, 0, 0, 1},
  { 1,10, 0, 0, 0, 0, 0, 0, 0, 1},
  { 1, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  { 1, 0, 1, 0, 0, 0, 0, 0, 0, 1},
  { 1, 0, 0, 0, 0, 1, 0, 0, 0, 1},
  { 1, 2, 0, 0, 0, 0, 0, 5, 4, 1},
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
};
int level4[8][10] = {
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  { 1, 5, 0, 0, 0, 0, 0, 0, 4, 1},
  { 1, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  { 1, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  { 1, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  { 1, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  { 1, 0, 0, 0, 2, 0, 0, 0, 3, 1},
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
};
int level7[8][10] = {
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  { 1, 5, 0, 0, 0, 1, 0, 0, 0, 1},
  { 1, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  { 1, 0, 1, 0, 0, 0, 0, 0, 1, 1},
  { 1, 9, 0,10, 0, 0, 0, 0, 4, 1},
  { 1, 9,10, 0, 0, 0, 0, 0, 0, 1},
  { 1, 1, 2, 0, 0, 0, 0, 0, 3, 1},
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
};
int level8[8][10] = {
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  { 1, 0, 0, 0, 0, 1, 0, 0, 8, 1},
  { 1, 0, 1, 4, 0, 0, 0, 1, 1, 1},
  { 1, 0, 1, 5, 0, 0, 0, 0, 0, 1},
  { 1, 0, 0, 7, 0, 0, 0, 0, 0, 1},
  { 1, 0, 0, 1, 0, 3,10, 0, 0, 1},
  { 1, 0, 0, 0, 2, 0,10, 0, 0, 1},
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
};
int level9[8][10] = {
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  { 1, 0, 0, 6, 0, 0,10, 0, 0, 1},
  { 1, 4, 0, 0, 0, 0, 0, 0, 0, 1},
  { 1,10, 0, 0, 0, 0, 0, 0,10, 1},
  { 1, 5, 0, 0, 0, 0, 0, 0,10, 1},
  { 1,10, 0, 0, 0, 0, 0, 0, 0, 1},
  { 1, 0, 0, 2,10,10, 3, 0, 0, 1},
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
};
int level10[8][10] = {
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  { 1, 0, 0,10, 4, 5, 0, 0, 0, 1},
  { 1, 0, 0, 6, 0, 0, 0, 0, 0, 1},
  { 1, 0, 0, 0, 0, 0, 0, 0,10, 1},
  { 1, 0, 0, 0,10, 0, 0, 0,10, 1},
  { 1, 0, 0,10,10, 0, 0, 0, 0, 1},
  { 1, 2, 0, 0,10,10, 0, 0, 3, 1},
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
};
int level12[8][10] = {
	{ 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
	{ 1, 5, 0, 0, 1, 1, 0, 0, 4, 1},
	{ 1, 0, 0, 0, 1, 1, 0, 0, 0, 1},
	{ 1, 0, 0, 0, 1, 1, 0, 0, 0, 1},
	{ 1, 2, 0, 0,10,10, 0, 0, 3, 1},
	{ 1, 0, 0, 0, 1, 1, 0, 0, 0, 1},
	{ 1, 0,10, 0,10,10, 0, 0, 0, 1},
	{ 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
};
int level13[8][10] = {
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  { 1, 0, 0, 0, 0,10, 0,10, 5, 1},
  { 1, 0, 1, 1, 0, 0, 0, 1, 1, 1},
  { 1, 0, 6, 1, 0, 0, 0, 0, 0, 1},
  { 1, 0,10, 1, 0, 0, 0, 0, 0, 1},
  { 1, 0, 0, 1, 0, 7,10, 7, 7, 1},
  { 1, 2, 3, 1, 0, 1, 4, 1, 1, 1},
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
};
int level11[8][10] = {
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  { 1, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  { 1, 0, 0, 0, 0, 0, 1, 0, 0, 1},
  { 1, 0, 0, 0, 0, 0, 0, 0, 5, 1},
  { 1, 4, 0, 0, 0, 0, 0, 0, 1, 1},
  { 1, 1, 0, 0, 0, 0, 0, 0, 3, 1},
  { 1, 2, 0, 0, 0, 0, 0, 1, 1, 1},
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
};
int level14[8][10] = {
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  { 1, 0, 0, 0,10, 0, 0,10, 0, 1},
  { 1, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  { 1, 3, 0, 0, 0, 0, 0, 0, 0, 1},
  { 1, 4, 0, 0, 0, 0, 0, 0, 0, 1},
  { 1, 0, 0, 0, 0, 0, 1, 0, 0, 1},
  { 1, 2, 0, 0, 0, 0, 0, 0, 5, 1},
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
};
int level15[8][10] = {
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  { 1, 0, 0, 0, 0, 0, 0, 4, 5, 1},
  { 1, 0, 1, 1, 0, 1, 1, 1, 1, 1},
  { 1, 0, 0,10, 0, 0, 0, 0, 0, 1},
  { 1, 7, 7, 7, 7, 7, 7, 7, 0, 1},
  { 1, 1, 1, 1, 1, 1, 1, 1, 0, 1},
  { 1, 2, 0, 0, 3, 0, 0, 0, 0, 1},
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
};
int level16[8][10] = {
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  { 1, 0, 0, 1, 0, 0, 0, 0, 0, 1},
  { 1, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  { 1, 0, 0, 0, 1, 0, 0, 0, 0, 1},
  { 1, 0, 0, 0, 0, 0, 0, 0, 5, 1},
  { 1,10, 0, 0, 0, 0, 0, 0, 0, 1},
  { 1, 2,10, 0, 0, 0, 0, 3, 4, 1},
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
};
int level17[8][10] = {
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  { 1, 3,10,10,10, 0, 0, 1, 0, 1},
  { 1,10, 2,10,10, 0, 0, 0, 0, 1},
  { 1,10,10, 0, 0, 0, 1, 0, 0, 1},
  { 1,10,10, 0, 1, 0, 0, 0, 0, 1},
  { 1, 0, 0, 0, 0, 0, 0, 0, 4, 1},
  { 1, 0, 0, 1, 0, 1, 0, 1, 5, 1},
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
};
int level18[8][10] = {
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  { 1, 6, 0, 0, 0, 1, 0, 0, 0, 1},
  { 1, 0, 0,10, 3, 0, 0, 0, 2, 1},
  { 1, 10, 0,10, 0,10, 0, 0, 1, 1},
  { 1, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  { 1, 0,10, 0, 0, 0, 0, 0, 0, 1},
  { 1, 0, 0, 0, 0, 4, 1, 7, 5, 1},
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
};
int level19[8][10] = {
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  { 1, 1,10, 0, 0, 0, 0, 1, 2, 1},
  { 1, 1, 0, 0, 0, 1, 0, 1, 0, 1},
  { 1, 0, 0, 0, 0, 0, 0, 1, 0, 1},
  { 1, 0, 1, 5, 1, 0, 4, 1, 0, 1},
  { 1, 0, 1, 1, 1, 0, 1, 1, 0, 1},
  { 1, 0, 0, 0,10, 0, 0, 0, 3, 1},
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
};
int level20[8][10] = {
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  { 1, 6, 6, 6, 6, 6, 6, 6, 6, 1},
  { 1, 2, 0, 0, 0, 0, 0, 0, 0, 4},
  { 1, 3, 0, 0, 0, 0, 0, 0, 0, 5},
  { 1, 7, 7, 7, 7, 7, 7, 7, 7, 1},
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
};

/////////////////////////////////

int level_nb = 1;
bool onBase = false;

int timo_X = 0;
int timo_Y = 0;
int timo_NX = 0;
int timo_NY = 0;
int timoD = 0;
int timo_T = 8;
bool timoOnBase;

int tima_X = 0;
int tima_Y = 0;
int tima_NX = 0;
int tima_NY = 0;
int timaD = 0;
int tima_T = 8;
bool timaOnBase = false;

bool isLives = true;
int dead_X;
int dead_Y;
int dead_f=0;
bool dead_anim = true;
int tspeed = 3;
bool timo_move_ok = true;
bool tima_move_ok = true;

int openning_T = 0;
bool openning_l = true;
int menu_games = 0;

bool base_snd = true;
bool base_snd2 = true;
void setup() {
  gb.begin();
}

void loop() {
  while(!gb.update());

  switch (menu_games){
    case 0:
     gb.display.clear();
     gb.display.drawImage(0,0,titre);
     gb.display.setCursor(22,48);
     gb.display.print("Press 'A'");
     if(gb.buttons.pressed(BUTTON_A)){
      menu_games = 4;
     }
    break;
    case 1:
      draw_levelName();
    break;
    case 2:
      init_games();
      menu_games=3;
    break;
    case 3:
      // update
      updateMeta();
  
      //  draw
      gb.display.clear();
      drawMeta();   
    break;
    case 4:
      gb.display.clear();
      gb.display.drawImage(0,0,tuto);
      if(gb.buttons.pressed(BUTTON_A)){
       menu_games = 1;
      }
    break;
    case 5:
      gb.display.clear();
      gb.display.drawImage(0,0,win);
      if(gb.buttons.pressed(BUTTON_A)){
       level_nb = 1;
       init_games();
       menu_games = 0;
      }
    break;
  }
}

void init_games(){
  timaOnBase = false;
  timoOnBase = false;
  isLives = true;
  dead_f=0;
  dead_anim = true;
  tspeed = 3;
  timo_move_ok = true;
  tima_move_ok = true;
  openning_T = 0;
  openning_l = true;
  loadLevel(level_nb);
  onBase = false;
}
